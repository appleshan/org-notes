#+TITLE: Git å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•

* å¦‚ä½•æ£€æŸ¥å½“å‰åˆ†æ”¯ä¸­æ²¡æœ‰ä»€ä¹ˆè¦æäº¤çš„ï¼Ÿ
æ‰‹åŠ¨æ›´æ–°ä»£ç ï¼ˆåŒ…æ‹¬å­æ¨¡å—ï¼‰ï¼Œä¸åˆ©äºæœ‰äº›é¡¹ç›®è‡ªåŠ¨åŒ–æ‰§è¡Œï¼›è€Œåˆ©ç”¨è„šæœ¬æ‰§è¡Œï¼Œéœ€è¦æ‰§è¡Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰éœ€è¦æäº¤çš„å†…å®¹ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯ï¼Œå¯¼è‡´è„šæœ¬æ‰§è¡Œä¸­æ–­ï¼›[[https://stackoverflow.com/questions/5139290/how-to-check-if-theres-nothing-to-be-committed-in-the-current-branch][å¦‚ä½•æ£€æŸ¥å½“å‰åˆ†æ”¯ä¸­æ²¡æœ‰ä»€ä¹ˆè¦æäº¤çš„]]ï¼Ÿä¸‹é¢è¿™æ®µä»£ç å¯ä»¥å‚è€ƒï¼š
#+BEGIN_SRC sh
#!/usr/bin/env sh

# ç¡®ä¿è„šæœ¬æŠ›å‡ºé‡åˆ°çš„é”™è¯¯
set -e

# æ›´æ–°é¡¹ç›®ä¸‹æ‰€ç”¨åˆ°çš„æ‰€æœ‰å­æ¨¡å— & æäº¤
git submodule foreach git pull

if [ -n "$(git status --porcelain)" ]; then
  git add tools
  git commit -m 'ğŸ“Œ uodate tools submodule'
  git push
else
  echo "there no changes about submodule ğŸ–¥";
fi
#+END_SRC

* Git å¦‚ä½•åˆ›å»ºå¹²å‡€çš„ç©ºåˆ†æ”¯?
#+BEGIN_SRC sh
git checkout --orphan empty-branch
git rm -rf .
git commit --allow-empty -m "root commit"
git push origin empty-branch
#+END_SRC
æ›´è¯¦ç»†çš„å†…å®¹ï¼Œå¯ä»¥å‚è§ [[https://stackoverflow.com/questions/34100048/github-create-empty-branch/34100189#34100189][Github create empty branch]]ã€‚

* å¦‚ä½•è§£å†³ .gitignore ä¸èµ·ä½œç”¨é—®é¢˜
=.gitignore= ä»…é€‚ç”¨äºæœªè·Ÿè¸ªçš„æ–‡ä»¶ã€‚å¦‚æœæ‚¨æ­£åœ¨è·Ÿè¸ªï¼Œé‚£ä¹ˆ =.gitignore= å°†ä¸é€‚ç”¨ï¼›å¦‚æœæƒ³æš´åŠ›çš„è§£å†³ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œäºˆä»¥ä¿®å¤ï¼š
#+BEGIN_SRC sh
git rm --cached -r .
git add .
#+END_SRC
æ›´è¯¦ç»†çš„ç­”æ¡ˆï¼Œå¯å‚è§: [[https://stackoverflow.com/questions/1139762/ignore-files-that-have-already-been-committed-to-a-git-repository][ignore-files-that-have-already-been-committed-to-a-git-repository]]ã€‚

* å¦‚ä½•åˆ é™¤è¿œç¨‹åˆ†æ”¯
#+BEGIN_SRC sh
git push origin --delete branch-name
// eg:
git push origin --delete develop
#+END_SRC

* Git åŒæ—¶ push åˆ°å¤šä¸ªä»“åº“(åŒæ­¥)
ä¸ºé˜²æ­¢ä¸€ä¸ª Git ä»“åº“ç”±äºå„ç§åŸå› é€ æˆæ— æ³•è®¿é—®ï¼Œå¯ä»¥å°†ä»£ç  push åˆ°å¤šä¸ªä»“åº“ã€‚ç¼–è¾‘æœ¬åœ°ä»“åº“ç›®å½•ä¸‹é¢çš„ .git ç›®å½•ä¸‹çš„ config æ–‡ä»¶ï¼ˆå‘½ä»¤ï¼š=vim ./git/config=ï¼‰ã€‚æ·»åŠ ç±»å¦‚ä»¥ä¸‹å‘½ä»¤ï¼š
#+BEGIN_SRC conf
[remote "all"]
url = git@github.com:licess/licess.git
url = git@gitcafe.com:licess/licess.git
#+END_SRC
å† push æ—¶ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š
#+BEGIN_SRC sh
git push all master
#+END_SRC

* å¦‚ä½•åˆ‡æ¢å¤šä¸ª GitHub è´¦å·
Git å…±æœ‰ä¸‰ä¸ªçº§åˆ«çš„ config æ–‡ ä»¶ï¼Œåˆ†åˆ«æ˜¯ systemã€global å’Œ localã€‚å¯ä»¥ä½¿ç”¨ =git config --list | grep user= ï¼ˆwindows éœ€ç”¨ sls æ›¿æ¢ grepï¼‰æ¥æŸ¥çœ‹é…ç½®ï¼›å½“ git commit æ—¶ï¼ŒAuthor ä¿¡æ¯ä¾æ¬¡è¯»å– localã€global å’Œ system çš„é…ç½®ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ä¸å†ç»§ç»­è¯»å–ã€‚å…¶ä»–é…ç½®çš„è¯»å–é¡ºåºä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ›´æ”¹é…ç½®å¯è¿è¡Œï¼š=git config --local user.name your-name= ï¼Œæ›´å¤šè¯¦æƒ…å¯æŸ¥çœ‹ [[http://www.jianshu.com/p/0ad3d88c51f4][è¿™é‡Œ]]ã€‚

* ä» Git å­˜å‚¨åº“ä¸­åˆ é™¤æ•æ„Ÿæ•°æ®
#+BEGIN_SRC sh
git filter-branch --commit-filter '
if [ "$GIT_AUTHOR_EMAIL" = "your-secret-email" ];
then
        GIT_AUTHOR_NAME="your-can-be-known-name";
        GIT_AUTHOR_EMAIL="your-can-be-known-email";
        GIT_COMMITTER_NAME="your-can-be-known-name";
        GIT_COMMITTER_EMAIL="your-can-be-known-email";
        git commit-tree "$@";
else
        git commit-tree "$@";
fi' HEAD
#+END_SRC
å…·ä½“å¯å‚è§ï¼š[[https://help.github.com/articles/removing-sensitive-data-from-a-repository/][Removing sensitive data from a repository]]ã€‚

* å¦‚ä½•ä¿®æ”¹æäº¤çš„ Message
- =git commit --amend= å¯ä»¥å¯¹ä¸Šä¸€æ¬¡æäº¤åšä¿®æ”¹ï¼ˆå¦‚æœè¿˜æ²¡ push çš„è¯ï¼‰ï¼›
- =git commit --amend --no-edit= ä¿®æ”¹æäº¤ï¼Œå´ä¸æ›´æ”¹ commit messageï¼›
- =push -f= å¦‚æœä¸Šä¸€æ¬¡çš„æäº¤å·²ç» push äº†ï¼Œé‚£ä¹ˆéœ€è¦åŠ  f å‚æ•°è¦†ç›–ï¼ˆéœ€æ…é‡ï¼‰ã€‚

* Git stash ç”¨äºä¿å­˜å’Œæ¢å¤å·¥ä½œè¿›åº¦
- Git stash
ä¿å­˜å½“å‰çš„å·¥ä½œè¿›åº¦ã€‚ä¼šåˆ†åˆ«å¯¹æš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„çŠ¶æ€è¿›è¡Œä¿å­˜
- Git stash save "message..."
è¿™æ¡å‘½ä»¤å®é™…ä¸Šæ˜¯ç¬¬ä¸€æ¡ =git stash= å‘½ä»¤çš„å®Œæ•´ç‰ˆ
- Git stash list
æ˜¾ç¤ºè¿›åº¦åˆ—è¡¨ã€‚æ­¤å‘½ä»¤æ˜¾ç„¶æš—ç¤ºäº† Git stash å¯ä»¥å¤šæ¬¡ä¿å­˜å·¥ä½œè¿›åº¦ï¼Œå¹¶ç”¨åœ¨æ¢å¤æ—¶å€™è¿›è¡Œé€‰æ‹©
- Git stash pop [--index] []
å¦‚æœä¸ä½¿ç”¨ä»»ä½•å‚æ•°ï¼Œä¼šæ¢å¤æœ€æ–°ä¿å­˜çš„å·¥ä½œè¿›åº¦ï¼Œå¹¶å°†æ¢å¤çš„å·¥ä½œè¿›åº¦ä»å­˜å‚¨çš„å·¥ä½œè¿›åº¦åˆ—è¡¨ä¸­æ¸…é™¤ã€‚
å¦‚æœæä¾›å‚æ•°ï¼ˆæ¥è‡ª =git stash list= æ˜¾ç¤ºçš„åˆ—è¡¨ï¼‰ï¼Œåˆ™ä»è¯¥é€‰é¡¹ä¸­æ¢å¤ã€‚æ¢å¤å®Œæ¯•ä¹Ÿå°†ä»è¿›åº¦åˆ—è¡¨ä¸­åˆ é™¤ã€‚
--index é™¤äº†æ¢å¤å·¥ä½œåŒºçš„æ–‡ä»¶å¤–ï¼Œè¿˜å°è¯•æ¢å¤æš‚å­˜åŒºã€‚
- Git stash apply [--index] []
é™¤äº†ä¸åˆ é™¤æ¢å¤çš„è¿›åº¦ä¹‹å¤–ï¼Œå…¶ä½™å’Œ =git stash pop= å‘½ä»¤ä¸€æ ·
- Git stash clear
åˆ é™¤æ‰€æœ‰å­˜å‚¨çš„è¿›åº¦

* ä½¿ç”¨ Git Submodule ç®¡ç†å­æ¨¡å—
=git Submodule= æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¤šé¡¹ç›®ä½¿ç”¨å…±åŒç±»åº“çš„å·¥å…·ï¼Œä»–å…è®¸ç±»åº“é¡¹ç›®åšä¸º=repository=,å­é¡¹ç›®åšä¸ºä¸€ä¸ªå•ç‹¬çš„gité¡¹ç›®å­˜åœ¨çˆ¶é¡¹ç›®ä¸­ï¼Œå­é¡¹ç›®å¯ä»¥æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„=commit=ï¼Œ=push=ï¼Œ=pull=ã€‚è€Œçˆ¶é¡¹ç›®ä»¥=Submodule=çš„å½¢å¼åŒ…å«å­é¡¹ç›®ï¼Œçˆ¶é¡¹ç›®å¯ä»¥æŒ‡å®šå­é¡¹ç›®=header=ï¼Œçˆ¶é¡¹ç›®ä¸­ä¼šçš„æäº¤ä¿¡æ¯åŒ…å«=Submodule=çš„ä¿¡æ¯ï¼Œå†=clone=çˆ¶é¡¹ç›®çš„æ—¶å€™å¯ä»¥æŠŠ=Submodule=åˆå§‹åŒ–ã€‚

** åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Submodule
#+BEGIN_SRC sh
git submodule add https://github.com/nicejade/awesome-vue-cli3-example.git custom-module-name
#+END_SRC

** æ›´æ–° Submodule
#+BEGIN_SRC sh
# æ–¹æ³•ä¸€ï¼šåœ¨çˆ¶é¡¹ç›®çš„ç›®å½•ä¸‹ç›´æ¥è¿è¡Œ
git submodule foreach git pull

# æ–¹æ³•äºŒï¼šåœ¨Submoduleçš„ç›®å½•ä¸‹é¢æ›´æ–°
cd  custom-module-name && git pull
#+END_SRC

=Submodule= çš„ç›®å½•ä¸­,ä½¿ç”¨=git=å’Œå•ç‹¬çš„ä¸€ä¸ªé¡¹ç›®æ˜¯ä¸€æ ·çš„,æ³¨æ„æ›´æ–°=Submodule=çš„æ—¶å€™å¦‚æœæœ‰æ–°çš„=commit id=äº§ç”Ÿï¼Œéœ€è¦åœ¨çˆ¶é¡¹ç›®äº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ï¼Œå­æ¨¡å—æ–‡ä»¶ä¸­çš„ =Subproject commit=ä¼šå˜ä¸ºæœ€æ–°çš„=commit id=ã€‚

** å…‹éš†å«æœ‰å­æ¨¡å—çš„é¡¹ç›®
#+BEGIN_SRC sh
# åˆå§‹åŒ–æœ¬åœ°é…ç½®æ–‡ä»¶
git submodule init
# æŠ“å–æ‰€æœ‰æ•°æ®å¹¶æ£€å‡ºçˆ¶é¡¹ç›®ä¸­åˆ—å‡ºçš„åˆé€‚çš„æäº¤ï¼ˆ`--recursive`é€’å½’ï¼‰
git submodule update --recursive
#+END_SRC

** å¦‚ä½•æœ‰æ•ˆåˆ é™¤ Submodule
#+BEGIN_SRC sh
git submodule deinit -f custom-module-name
rm -rf .git/modules/custom-module-name
git rm -f custom-module-name
git rm --cached custom-module-name
#+END_SRC

* Git å¦‚ä½•åˆå¹¶å¤šç¬” Commit
- æŸ¥çœ‹æäº¤å†å²ï¼ŒGit log
- é€‰æ‹©å‡ºæƒ³è¦åˆå¹¶çš„é‚£å‡ æ¡
#+BEGIN_SRC sh
# ä»HEADç‰ˆæœ¬å¼€å§‹å¾€è¿‡å»æ•° 2ä¸ªç‰ˆæœ¬
git rebase -i HEAD~2

# æŒ‡åè¦åˆå¹¶çš„ç‰ˆæœ¬ã€Œä¹‹å‰ã€çš„ç‰ˆæœ¬å·
git rebase -i 1a3146b
#+END_SRC
æ³¨æ„ =1a3146b= è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸å‚ä¸åˆå¹¶çš„ï¼Œå¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªåæ ‡ã€‚

- é€‰å–è¦åˆå¹¶çš„æäº¤
æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤ä¹‹åï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹å†…å®¹çª—å£ï¼Œå°†è¦åˆå¹¶çš„é‚£ï¼ˆå‡ ï¼‰æ¡ =pick=æ”¹ä¸º=squash=æˆ–è€… =s=,ä¹‹åä¿å­˜å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘çª—å£å³å¯ã€‚
#+BEGIN_EXAMPLE
0 pick 301747e test merge commit 01
1 pick 5f83c1c test merge commit 02
#+END_EXAMPLE
ç„¶åä¿å­˜é€€å‡ºï¼ŒGit ä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å²ï¼Œä¸ç„¶æˆ‘ä»¬çš„ä¿®æ”¹å°±ä¸¢å¼ƒäº†ã€‚ä¿®æ”¹ä»¥åè¦è®°å¾—æ•²ä¸‹é¢çš„å‘½ä»¤ï¼š

#+BEGIN_SRC sh
git add .
git rebase --continue
#+END_SRC
å¤‡æ³¨ï¼šå¦‚æœä½ æƒ³æ”¾å¼ƒè¿™æ¬¡åˆå¹¶çš„è¯ï¼Œå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

#+BEGIN_SRC sh
git rebase --abort
#+END_SRC

