#+TITLE: 科学上网之 EC2 搭建 shadowsocks

* 说在前面的话
- 首先要说的是这应该是目前性价比最高的科学上网的方式，AWS 免费一年，到期后，再去买
VPS 来搭建 shadowsocks，也是一个道理，关键是比购买 vpn 或 shadowsocks 账户划算的多。
- 这篇教程中的步骤是有一定时效性的，有些步骤可能随着 AWS 升级，相关软件升级等等会变
得不太一样，这时候需要灵活应变；
- 这是一篇非常啰嗦的教程，特别是申请 AWS 的步骤，写这么细主要是想把整个过程还原出来
- 如果因为哪些步骤被卡住无法进行下去，均可在留言中说明，我会尽可能解答并更新到文中

* 服务端配置
** 申请 AWS
1. 打开 =[[http://aws.amazon.com/cn/][AWS 官网]]=
[[file:images/1.png]]
2. 输入邮箱，选择新用户，点击 =登录=
[[file:images/2.png]]
3. 填写注册信息，点击 =创建账户=
[[file:images/3.png]]
4. 填写信用卡信息，点击 =继续=
[[file:images/4.png]]
5. 填写手机号码，点击 =立即呼叫我=
[[file:images/5.png]]
几十秒后就会有一个电话打来，等电话里的妹子说完话，输入 PIN 码
[[file:images/6.png]]
输完后，妹子又说几句话就挂了电话，这时身份验证已经完成，点击 =继续= 选择支持方案
[[file:images/7.png]]
6. 选择方案，默认选基本，点击 =继续=
[[file:images/8.png]]
7. 这时账户创建成功，点击 =启动管理控制台=
[[file:images/9.png]]
** 新建 EC2
1. 进入 AWS 主页，选择第一个：EC2
[[file:images/10.png]]
2. 进入 EC2 控制台，选择右上角 =弗吉尼亚北部= ，弹出下拉菜单，推荐选择
=亚太地区（东京）=
EC2 控制台刷新后，点击 =启动实例=
[[file:images/11.png]]
3. 选择 =符合条件的免费套= ubuntu
[[file:images/12.png]]
4. 默认的选择第一个即可， 点击 =审核和启动=
[[file:images/13.png]]
5. 点击 =启动= ，
[[file:images/14.png]]
6. 创建新密钥对，输入名称，点击下载密钥对（一个*.pem 文件），保存到电脑上，点击
=启动实例=
[[file:images/15.png]]
7. 这样就创建好一个在东京的服务器节点，点击 =查看实例=
[[file:images/16.png]]
这个时候 AWS 开始初始化的你的服务器节点，大概需要一两分钟

** 连接远程服务器
- 如果是 windows，参考官方教程《使用 putty 连接远程服务器》 =（链接已经失效）=
- 如果是 mac，
首先，找到刚刚保存的 =*.pem= 文件，比如文件名叫 =amazon.pem= ，确认文件路径，
打开终端，进到 =amazon.pem= 文件所在目录，
执行 =chmod 400 amazon.pem= 修改文件权限
执行 =ssh -i amazon.pem ubuntu@你的服务器节点 ip= 即可连接上远程服务器
[[file:images/17.png]]

** 安装 shadowsocks 依赖
1. sudo -s // 获取超级管理员权限
2. apt-get update // 更新 apt-get
3. apt-get install python-pip // 安装 python 包管理工具 pip
4. pip install shadowsocks // 安装 shadowsocks
5. ssserver -c /etc/shadowsocks.json -d start // 启动 shadowsocks

** 配置 shadowsocks
vi /etc/shadowsocks.json

- 单一端口配置：
#+BEGIN_SRC javascript
{
    "server":"0.0.0.0",
    "server_port":端口,
    "local_address":"127.0.0.1",
    "local_port":1080,
    "password":"连接密码",
    "timeout":300,
    "method":"aes-256-cfb",
    "fast_open":false
}
#+END_SRC

- 多端口配置：
#+BEGIN_SRC javascript
{
    "server":"0.0.0.0",
    "port_password": {
        "端口 1": "连接密码 1",
        "端口 2" : "连接密码 2"
    },
    "timeout":300,
    "method":"aes-256-cfb",
    "fast_open": false
}
#+END_SRC

** 开启 AWS 入站端口
配置好 shaodowsocks 后，还需要将配置中的端口打开,这样客户端的服务才能链接得上
EC2 中的 shadowsocks 服务。
首先打开正在运行的实例，向右滚动表格，
[[file:images/18.png]]
看到最后一项，安全组，点击进入
[[file:images/19.png]]
点击操作，编辑入站规则
[[file:images/20.png]]
默认是开启了一个 22 端口（这是给 ssh 访问的），再建一个如下图红框标示的端口，
我的 shadowsocks 配置的端口是 8388，所以这里就开启 8388。
[[file:images/21.png]]
** 订单监控
1. AWS 提供的服务是每个月 15G 流量，目前我不知道有什么方法可以监控每个月流量使用
的情况，但是可以通过设置订单监控来提醒我是否有超过免费使用的额度，即每当我的账号
费用超过$0,那 amazon 就会发邮件提醒我
2. 点击右上角的用户名 -> 我的账户，然后点击左边首选项即可打开以下页面
勾选 =接收账单报警= ，点击 =保存首选项=
 [[file:images/22.png]]
3. 点击左上方 =服务= ，点击 =账单=
[[file:images/23.png]]
4. 点击 =设置第一个账单警报=
[[file:images/24.png]]
5. 点击 =创建账单警报=
[[file:images/25.png]]
6. 第一个项填写 0 即可，第二项填写你能接收到邮件的邮箱地址，点击 =创建警报=
[[file:images/26.png]]
7. 这时会弹出这个页面，这个时候登录邮箱，打开 Amazon 发来的邮件（有可能在垃圾邮件
里），点击邮件里的链接确认即可
[[file:images/27.png]]
8. 登录邮箱确认后，会变成这样，点击 =查看报警= ，
[[file:images/28.png]]
这样就完成了订单监控
[[file:images/29.png]]
至此，服务端的要做的事情就全部完成了。
